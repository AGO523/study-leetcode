### トポロジカルソート（Topological Sort）とは？

**トポロジカルソート**は、有向グラフにおいて **ノード（頂点）を並べる順序**を決定するアルゴリズムです。並べられた順序では、すべての **エッジ（有向辺）**が以下の条件を満たす必要があります：

- 各エッジ `(u, v)` に対して、ノード `u`（始点）が `v`（終点）より前に来る。
- つまり、「あるノード `v` に到達する前に、その前提条件であるノード `u` を先に処理しなければならない」という依存関係を満たす。

### 使用される場面

トポロジカルソートは、以下のような **「依存関係を持つ順序付け」**が必要な問題を解くときに使われます：

1. **コースの受講順序（課題の優先順位）**：

   - 「コース 1 を受講するには、コース 0 を修了しなければならない」といった依存関係を持つ課題の並べ替え。
   - 前の問題「すべてのコースを修了できるか？」「コースの修了順序を返す」など。

2. **タスクのスケジューリング**：

   - タスク A を完了しないとタスク B を実行できない、といった依存関係を持つタスクの順序を決定する。

3. **プログラムのコンパイル順序**：
   - あるファイルが別のファイルを参照している場合、その依存関係を考慮して、プログラムを正しい順序でコンパイルする。

### 具体例を使った解説

例えば、次のようなコースの依存関係を持つグラフを考えましょう：

- **ノード（頂点）**は「コース」、**エッジ（辺）**は「前提条件」を表します。

#### 例: コースの依存関係

- **コース数**: 4 (`num_courses = 4`)
- **前提条件**（依存関係）:

  ```plaintext
  prerequisites = [[1, 0], [2, 0], [3, 1], [3, 2]]
  ```

  - コース 1 を受講するには、まずコース 0 を修了する必要があります。
  - コース 2 を受講するには、まずコース 0 を修了する必要があります。
  - コース 3 を受講するには、コース 1 とコース 2 の両方を修了する必要があります。

#### 依存関係のグラフ表現

グラフを描画すると以下のようになります：

```
  0
 / \
1   2
 \ /
  3
```

#### トポロジカルソートの実行手順

この依存グラフに対して、トポロジカルソートを適用してみましょう。

1. **入次数（indegree）の初期化**：

   - 各ノード（コース）が他のノードに依存される数を数えます。
   - 入次数が 0 のノードはどのコースからも依存されていないので、まず処理することができます。

   | コース | 入次数 |
   | ------ | ------ |
   | 0      | 0      |
   | 1      | 1      |
   | 2      | 1      |
   | 3      | 2      |

   入次数が 0 のコース: 0

2. **入次数が 0 のノードをキュー（queue）に追加**：

   - ここでは、コース 0 しかありません。
   - `queue = [0]`

3. **BFS を用いたトポロジカルソートの実行**：

   - キューからノードを取り出し、そのノードを修了済みにします。
   - そのノードに依存している他のノードの入次数を 1 ずつ減らします。
   - 入次数が 0 になったノードをキューに追加します。

   1. **コース 0** を処理:

      - `queue = [0]`
      - `order = []`（処理順序）
      - 依存コース: コース 1, コース 2
      - コース 1 とコース 2 の入次数を 1 ずつ減らす。
      - コース 1 と 2 の入次数は 0 になったので、キューに追加。
      - `queue = [1, 2]`
      - `order = [0]`

   2. **コース 1** を処理:

      - `queue = [1, 2]`
      - `order = [0]`
      - 依存コース: コース 3
      - コース 3 の入次数を 1 ずつ減らす → 入次数は 1。
      - `queue = [2]`
      - `order = [0, 1]`

   3. **コース 2** を処理:

      - `queue = [2]`
      - `order = [0, 1]`
      - 依存コース: コース 3
      - コース 3 の入次数を 1 ずつ減らす → 入次数は 0。
      - キューにコース 3 を追加。
      - `queue = [3]`
      - `order = [0, 1, 2]`

   4. **コース 3** を処理:
      - `queue = [3]`
      - `order = [0, 1, 2]`
      - 依存コースはなし。
      - `order = [0, 1, 2, 3]`

4. **結果の確認**：
   - `order` に含まれているノード数が `num_courses` と一致するかを確認します。
   - 一致する場合 → すべてのコースを修了可能です。
   - 一致しない場合 → 循環依存があり、すべてのコースを修了することは不可能です。

この場合の結果:

```plaintext
[0, 1, 2, 3]
```

### トポロジカルソートのアルゴリズム

トポロジカルソートは、主に **BFS** と **DFS** の 2 つのアルゴリズムで実装されることが多いです。

- **BFS（幅優先探索）を使う方法**:

  1. すべてのノードの入次数を計算。
  2. 入次数が 0 のノードをキューに入れる。
  3. キューからノードを取り出し、そのノードに依存しているノードの入次数を減らす。
  4. 入次数が 0 になったノードをキューに追加。
  5. すべてのノードが処理されたら、順序を返す。

- **DFS（深さ優先探索）を使う方法**:
  1. 各ノードを再帰的に訪問。
  2. 訪問済みのノードは順序リストに追加。
  3. すべてのノードを訪問したら、順序リストを逆順にして返す。
